<!DOCTYPE html>
<html>

    <head>

        <title>

        Sign-in page
            
        </title>
      
        <link rel='stylesheet' href ='Sign in css'>

    </head>

    <body>
        <h2>Sign-in</h2>

        <form id = 'sign-in-form'>

            <label>Username:</label><br>
            <input type = 'text' id = userName placeholder = 'Username or Email' required><br><br>
            <label>Password:</label><br>
            <input type = 'password' id = passWord placeholder = 'Password' required><br><br>
            <button type='submit'>Login</button><br>

        </form>

        <p>Don't have an account <a href = 'signup.html'>Sign-up here</a></p>

        <script>
            const getUsers = () => {
            const usersJSON = localStorage.getItem('registeredUsers');
            try {
                    const storedData = JSON.parse(usersJSON);
                    if (Array.isArray(storedData)) return storedData;
                    if (typeof storedData === 'object' && storedData !== null) return Object.values(storedData);
                } catch (e) {
                    console.error("Error retrieving user data:", e);
                }
                return [];
        };

        function attemptSignin(){
            event.preventDefault();

            var loginId = document.getElementById('userName').value.trim();
            var passWord = document.getElementById('passWord').value;

            let usersArray = getUsers();
            // Find user by username or email
            var storedUser = usersArray.find(user => 
                user.username === loginId || 
                user.email === loginId 
            );

            if (!storedUser) {
                alert('⚠ Login Error: Account not found. Please check your details or sign up.');
                return;
            }

            // 3. Validate the password
                if (storedUser.password === passWord) {
                    alert(`✅ Sign-in Successful! Welcome back, ${storedUser.firstName || storedUser.username}.`);
                    // Save the user object to localStorage under a new key
                    localStorage.setItem('currentUser', JSON.stringify(storedUser));
                    //REDIRECT TO EVENT MANAGEMENT SYSTEM
                    window.location.href = 'eventms.html';
                    } else {
                    alert('⚠ Login Error: Invalid password.');
                }


            
        }
        document.getElementById('sign-in-form').addEventListener('submit', attemptSignin);
        </script>
    </body>
</html>